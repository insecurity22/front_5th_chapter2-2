import{r as g,u as R,j as e,c as F,R as M}from"./useCart-BGjFYUAa.js";const B=i=>{const[p,d]=g.useState(i);return{coupons:p,addCoupon:x=>{d(c=>[...c,x])}}},O=i=>{const[p,d]=g.useState(i);return{products:p,updateProduct:c=>{d(h=>h.map(a=>a.id===c.id?c:a))},addProduct:c=>{d(h=>[...h,c])}}},U=()=>({getMaxDiscount:d=>d.reduce((m,x)=>Math.max(m,x.rate),0),getAppliedDiscount:d=>{const{discounts:m}=d.product,{quantity:x}=d;let c=0;return m.forEach(h=>{x>=h.quantity&&(c=Math.max(c,h.rate))}),c}}),C=i=>`${i.toLocaleString()}원`,k=i=>`${(i*100).toFixed(0)}%`,L=({products:i,coupons:p})=>{const{cart:d,addToCart:m,removeFromCart:x,updateQuantity:c,applyCoupon:h,calculateTotal:a,selectedCoupon:u}=R(),{getMaxDiscount:j,getAppliedDiscount:y}=U(),b=t=>{const l=d.find(v=>v.product.id===t.id);return t.stock-((l==null?void 0:l.quantity)||0)},{totalBeforeDiscount:N,totalAfterDiscount:f,totalDiscount:w}=a();return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:i.map(t=>{const l=b(t);return e.jsxs("div",{"data-testid":`product-${t.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsx("span",{className:"text-gray-600",children:C(t.price)})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${l>0?"text-green-600":"text-red-600"}`,children:["재고: ",l,"개"]}),t.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대"," ",k(j(t.discounts)),"할인"]})]}),t.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((v,P)=>e.jsxs("li",{children:[v.quantity,"개 이상:"," ",k(v.rate)," 할인"]},P))}),e.jsx("button",{onClick:()=>m(t),className:`w-full px-3 py-1 rounded ${l>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:l<=0,children:l>0?"장바구니에 추가":"품절"})]},t.id)})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx("div",{className:"space-y-2",children:d.map(t=>{const l=y(t);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.product.price,"원 x ",t.quantity,l>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:[k(l)," 할인 적용"]})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>c(t.product.id,t.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:()=>c(t.product.id,t.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:()=>x(t.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]},t.product.id)})}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsxs("select",{onChange:t=>h(p[parseInt(t.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),p.map((t,l)=>e.jsxs("option",{value:l,children:[t.name," -"," ",t.discountType==="amount"?`${t.discountValue}원`:`${t.discountValue}%`]},t.code))]}),u&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",u.name,"(",u.discountType==="amount"?`${u.discountValue}원`:`${u.discountValue}%`," ","할인)"]})]}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",C(N)]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",C(w)]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",C(f)]})]})]})]})]})]})},Q=({products:i,coupons:p,onProductUpdate:d,onProductAdd:m,onCouponAdd:x})=>{const[c,h]=g.useState(new Set),[a,u]=g.useState(null),[j,y]=g.useState({quantity:0,rate:0}),[b,N]=g.useState({name:"",code:"",discountType:"percentage",discountValue:0}),[f,w]=g.useState(!1),[t,l]=g.useState({name:"",price:0,stock:0,discounts:[]}),v=s=>{h(o=>{const n=new Set(o);return n.has(s)?n.delete(s):n.add(s),n})},P=s=>{u({...s})},S=(s,o)=>{if(a&&a.id===s){const n={...a,name:o};u(n)}},D=(s,o)=>{if(a&&a.id===s){const n={...a,price:o};u(n)}},q=()=>{a&&(d(a),u(null))},A=(s,o)=>{const n=i.find(r=>r.id===s);if(n){const r={...n,stock:o};d(r),u(r)}},T=s=>{const o=i.find(n=>n.id===s);if(o&&a){const n={...o,discounts:[...o.discounts,j]};d(n),u(n),y({quantity:0,rate:0})}},$=(s,o)=>{const n=i.find(r=>r.id===s);if(n){const r={...n,discounts:n.discounts.filter((G,E)=>E!==o)};d(r),u(r)}},V=()=>{x(b),N({name:"",code:"",discountType:"percentage",discountValue:0})},I=()=>{const s={...t,id:Date.now().toString()};m(s),l({name:"",price:0,stock:0,discounts:[]}),w(!1)};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx("button",{onClick:()=>w(!f),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:f?"취소":"새 상품 추가"}),f&&e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:t.name,onChange:s=>l({...t,name:s.target.value}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:t.price,onChange:s=>l({...t,price:parseInt(s.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:t.stock,onChange:s=>l({...t,stock:parseInt(s.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:I,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]}),e.jsx("div",{className:"space-y-2",children:i.map((s,o)=>e.jsxs("div",{"data-testid":`product-${o+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>v(s.id),className:"w-full text-left font-semibold",children:[s.name," - ",s.price,"원 (재고: ",s.stock,")"]}),c.has(s.id)&&e.jsx("div",{className:"mt-2",children:a&&a.id===s.id?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:a.name,onChange:n=>S(s.id,n.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:a.price,onChange:n=>D(s.id,parseInt(n.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:a.stock,onChange:n=>A(s.id,parseInt(n.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),a.discounts.map((n,r)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[n.quantity,"개 이상 구매 시 ",n.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>$(s.id,r),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},r)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:j.quantity,onChange:n=>y({...j,quantity:parseInt(n.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:j.rate*100,onChange:n=>y({...j,rate:parseInt(n.target.value)/100}),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:()=>T(s.id),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),e.jsx("button",{onClick:q,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):e.jsxs("div",{children:[s.discounts.map((n,r)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[n.quantity,"개 이상 구매 시 ",n.rate*100,"% 할인"]})},r)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>P(s),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:b.name,onChange:s=>N({...b,name:s.target.value}),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:b.code,onChange:s=>N({...b,code:s.target.value}),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:b.discountType,onChange:s=>N({...b,discountType:s.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:b.discountValue,onChange:s=>N({...b,discountValue:parseInt(s.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:V,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:p.map((s,o)=>e.jsxs("div",{"data-testid":`coupon-${o+1}`,className:"bg-gray-100 p-2 rounded",children:[s.name," (",s.code,"):",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`," 할인"]},o))})]})]})]})]})]})},W=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],_=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],z=()=>{const{products:i,updateProduct:p,addProduct:d}=O(W),{coupons:m,addCoupon:x}=B(_),[c,h]=g.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:()=>h(!c),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:c?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:c?e.jsx(Q,{products:i,coupons:m,onProductUpdate:p,onProductAdd:d,onCouponAdd:x}):e.jsx(L,{products:i,coupons:m})})]})};F.createRoot(document.getElementById("root")).render(e.jsx(M.StrictMode,{children:e.jsx(z,{})}));
